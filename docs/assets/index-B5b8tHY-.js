(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();let m=class{constructor(t={}){this.type="none",this.x=0,this.y=0,this.w=0,this.h=0;const e=document.createElement("canvas"),s=e.getContext("2d");this._capture={cav:e,ctx:s},this._children=[]}SetData(t={}){Object.entries(t).forEach(([e,s])=>{this[e]=s})}},x=class extends m{constructor(t={}){super(),this.type="point",this.x=t.x??0,this.y=t.y??0,this.w=301,this.h=301,this.cx=151,this.cy=151,this.color=t.color??"white",this._draw={ctx:t.ctxDraw??null};const e=this._capture.cav,s=this._capture.ctx;w.SetCanvasDPR(e,s,this.w,this.h),s.font=`${a.fontWeight} ${a.fontSize}px ${a.fontFamily}`,s.fillStyle=this.color,s.textAlign="center",s.textBaseline="middle",this.Render()}Render(){const t=this._capture.cav,e=this._capture.ctx,s=4;e.clearRect(0,0,t.width,t.height),e.fillText(`( ${this.x}, ${this.y} )`,this.w/2,this.h/2+a.textHeight),e.beginPath(),e.arc(this.w/2,this.h/2,s,Math.PI*2,!1),e.fill()}Draw(t){if(this._draw.ctx==null)return;const e=t.PixelX(this.x)-this.cx,s=t.PixelY(this.y)-this.cy,i=this.w,n=this.h;this._draw.ctx.drawImage(this._capture.cav,0,0,this._capture.cav.width,this._capture.cav.height,e,s,i,n)}},v=class{constructor(t){if(!t||!t.type)return;const e=document.createElement(t.type);return t.class&&e.classList.add(...t.class.split(" ")),t.id&&(e.id=t.id),t.parentNode&&t.parentNode.appendChild(e),e}};const p=Math.round(window.devicePixelRatio)||1,_={SetCanvasDPR:M};function M(r,t,e,s){r.width=e*p,r.height=s*p,t.setTransform(1,0,0,1,0,0),t.scale(p,p)}const f={point:x},P={element:v},w=_,a=(function(){const r=getComputedStyle(document.documentElement),t={};return t.fontFamily=r.getPropertyValue("font-family"),t.fontSize=parseFloat(r.getPropertyValue("font-size")),t.fontWeight=parseFloat(r.getPropertyValue("font-weight")),t.textHeight=Math.round(t.fontSize*1.3),t})();let L=class{constructor(t={}){}},D=class{constructor(t={}){}},S=class{constructor(t={}){}},b=class{constructor(t={}){this.x=0,this.y=0,this.scope={dpr:1,min:1,max:6,zoom:2,width:0,height:0},this.layers={},this.InitLayers(t.parentNode),window.addEventListener("resize",e=>{this.Resize()}),this.Resize(),this.diagrams=[],this.LoadDiagrams(),this.Loop()}Loop=()=>{this.isDataUpdate&&(this.DataUpdate(),this.isDataUpdate=!1),this.isLogUpdate&&(this.LogUpdate(),this.isLogUpdate=!1),(this.isDragging||this.isResizing)&&(this.Draw(),this.isDragging=!1,this.isResizing=!1),requestAnimationFrame(this.Loop)};get zoom(){return this.scope.zoom}set zoom(t){t>=this.scope.min&&t<=this.scope.max&&(this.scope.zoom=t)}LoadDiagrams(){this.diagrams=[];const t=new f.point({x:100,y:100,ctxDraw:this.layers.background.ctx});this.diagrams.push(t),this.diagrams.push(new f.point({x:0,y:0,color:"red",ctxDraw:this.layers.background.ctx}))}InitLayers(t){this.layers={},["background","board","effect"].forEach(e=>{this.layers[e]={},this.layers[e].cav=new P.element({type:"canvas",parentNode:t,class:`window ${e}`}),this.layers[e].cav.style.position="absolute",this.layers[e].cav.style.width="100%",this.layers[e].cav.style.height="100%",this.layers[e].ctx=this.layers[e].cav.getContext("2d")})}Resize(){this.scope.width=window.innerWidth,this.scope.height=window.innerHeight,Object.values(this.layers).forEach(t=>{w.SetCanvasDPR(t.cav,t.ctx,window.innerWidth,window.innerHeight),t.ctx.translate(window.innerWidth/2,window.innerHeight/2)}),this.isResizing=!0}SpaceX(t){return this.x+Math.round((t-this.scope.width/2)*this.zoom)}SpaceY(t){return this.y+Math.round((t-this.scope.height/2)*this.zoom)}SpaceLine(t){return Math.round(t*this.zoom)}PixelX(t){return Math.round((t-this.x)/this.zoom)}PixelY(t){return Math.round((t-this.y)/this.zoom)}PixelLine(t){return Math.round(t/this.zoom)}Draw(){Object.values(this.layers).forEach(t=>{const e=t.cav.width,s=t.cav.height;t.ctx.clearRect(-e/2,-s/2,e,s)}),this.DrawLine(100,200,200,100,"orange"),this.DrawLine(0,0,200,100,"orange"),this.DrawLine(0,0,100,200,"orange"),this.DrawRuler();for(let t of this.diagrams)t.Draw(this)}DrawRuler(){if(!this.layers.background)return;const t=this.layers.background.ctx,e=-this.scope.width/2+10,s=-this.scope.height/2+10,i=100,n=this.scope.height-20;t.fillStyle="rgba(44, 44, 54, 1)",t.fillRect(e,s,i,n)}DrawBackground(){if(!this.layers.background)return;const t=this.layers.background.ctx,e=this.layers.background.cav,s=100,i=this.x%s;t.save(),t.strokeStyle=rgba(44,44,64,1),t.beginPath(),this.SpaceX(e.height/2);const n=this.SpaceX(e.height);for(let o=i;o<=this.SpaceX(e.width);o+=s){const h=this.PixelLine(o);t.moveTo(h-n+2500,-n+2500),t.lineTo(h+n-2500,n-2500)}t.stroke(),t.restore()}DrawPoint(t,e,s){if(!this.layers.background)return;const i=this.layers.background.ctx,n=this.PixelX(t),o=this.PixelY(e);i.save(),i.font=`${a.fontWeight} ${a.fontSize}px ${a.fontFamily}`,i.fillStyle=s,i.textAlign="center",i.textBaseline="middle",i.fillText(`( ${t}, ${e} )`,n,o+a.textHeight),i.beginPath(),i.arc(n,o,4,Math.PI*2,!1),i.fill(),i.restore()}DrawLine(t,e,s,i,n){if(!this.layers.background)return;const o=this.layers.background.ctx,h=this.PixelX(t),d=this.PixelY(e),l=this.PixelX(s),y=this.PixelY(i);o.save(),o.strokeStyle=n,o.beginPath(),o.moveTo(h,d),o.lineTo(l,y),o.stroke(),o.restore()}};const N=.001,I=.002;let A=class{constructor(t={}){const e=t.parentNode;e.addEventListener("contextmenu",async s=>{s.preventDefault()}),e.addEventListener("wheel",s=>{c.zoom-=s.deltaY*N,c.isDragging=!0},{passive:!0}),e.addEventListener("mousedown",s=>{this.PanStart(s.offsetX,s.offsetY)}),e.addEventListener("mousemove",s=>{this.PanMove(s.offsetX,s.offsetY)}),e.addEventListener("mouseup",()=>{this.PanEnd()}),e.addEventListener("mouseleave",()=>{this.down=null}),e.addEventListener("touchstart",s=>{if(s.touches.length===1&&this.touchMode!=="pinch"){const i=s.touches[0];this.touchMode="pan",this.PanStart(i.clientX,i.clientY)}if(s.touches.length===2){const i=s.touches[0],n=s.touches[1],o=i.clientX-n.clientX,h=i.clientY-n.clientY;this.touchMode="pinch",this.pinch={dist:Math.hypot(o,h)}}},{passive:!1}),e.addEventListener("touchmove",s=>{if(this.touchMode==="pan"&&s.touches.length===1){const i=s.touches[0];this.PanMove(i.clientX,i.clientY),s.preventDefault()}if(this.touchMode==="pinch"&&s.touches.length===2&&this.pinch){const i=s.touches[0],n=s.touches[1],o=i.clientX-n.clientX,h=i.clientY-n.clientY,d=Math.hypot(o,h),l=this.pinch.dist-d;this.pinch.dist=d,c.zoom+=l*I,c.isDragging=!0,s.preventDefault()}},{passive:!1}),e.addEventListener("touchend",s=>{if(this.touchMode==="pinch"&&s.touches.length<2){this.touchMode=null,this.pinch=null;return}this.touchMode==="pan"&&s.touches.length===0&&(this.touchMode=null,this.panEnd())})}PanStart(t,e){this.down={offsetX:t,offsetY:e,xView:c.x,yView:c.y},c.isDragging=!0}PanMove(t,e){if(!this.down)return;const s=c.SpaceLine(t-this.down.offsetX),i=c.SpaceLine(e-this.down.offsetY);c.x=this.down.xView-s,c.y=this.down.yView-i,c.isDragging=!0}async PanEnd(){this.down=null}};const E={};class R{constructor(t={}){this.worker=null,this.seq=0,this.pending=new Map;const s=!(typeof import.meta<"u"&&E);this.worker=s?new Worker("./src/storage/db.worker.js",{type:"module"}):new Worker(new URL(""+new URL("db.worker-CYGLrwb2.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=i=>{const{id:n,ok:o,result:h,error:d}=i.data,l=this.pending.get(n);l&&(this.pending.delete(n),o?l.resolve(h):(l.reject(d),console.warn(i.data)))},this.worker.onerror=i=>{console.error("worker error:",i.message)}}Call(t,e){return new Promise((s,i)=>{const n=++this.seq;this.pending.set(n,{resolve:s,reject:i}),this.worker.postMessage({id:n,type:t,payload:e})})}}const z=document.querySelector("#app"),g=new R;u(S,"menu");u(D,"favorite");u(L,"directory");const c=u(b,"view");u(A,"controller");const k=async()=>{await g.Call("init");const r=await g.Call("loadSetting",{});console.log(r)};k();function u(r,t){const e=document.createElement("div");return e.id=t,z.appendChild(e),new r({parentNode:e})}
