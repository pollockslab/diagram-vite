(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();let C=class{constructor(t={}){this.type="none",this.x=0,this.y=0,this.w=0,this.h=0;const e=document.createElement("canvas"),s=e.getContext("2d");this._capture={cav:e,ctx:s},this._children=[]}SetData(t={}){Object.entries(t).forEach(([e,s])=>{this[e]=s})}},m=class extends C{constructor(t={}){super(),this.type="point",this.x=t.x??0,this.y=t.y??0,this.w=301,this.h=301,this.cx=151,this.cy=151,this.color=t.color??"white",this._draw={ctx:t.ctxDraw??null};const e=this._capture.cav,s=this._capture.ctx;p.SetCanvasDPR(e,s,this.w,this.h),s.font=`${h.fontWeight} ${h.fontSize}px ${h.fontFamily}`,s.fillStyle=this.color,s.textAlign="center",s.textBaseline="middle",this.Render()}Render(){const t=this._capture.cav,e=this._capture.ctx,s=4;e.clearRect(0,0,t.width,t.height),e.fillText(`( ${this.x}, ${this.y} )`,this.w/2,this.h/2+h.textHeight),e.beginPath(),e.arc(this.w/2,this.h/2,s,Math.PI*2,!1),e.fill()}Draw(t){if(this._draw.ctx==null)return;const e=t.PixelX(this.x)-this.cx,s=t.PixelY(this.y)-this.cy,i=this.w,o=this.h;this._draw.ctx.drawImage(this._capture.cav,0,0,this._capture.cav.width,this._capture.cav.height,e,s,i,o)}},f=class{constructor(t){if(!t||!t.type)return;const e=document.createElement(t.type);return t.class&&e.classList.add(...t.class.split(" ")),t.id&&(e.id=t.id),t.parentNode&&t.parentNode.appendChild(e),e}};const d=Math.round(window.devicePixelRatio)||1,w={SetCanvasDPR:v};function v(c,t,e,s){c.width=e*d,c.height=s*d,t.setTransform(1,0,0,1,0,0),t.scale(d,d)}const y={point:m},A={element:f},p=w,h=(function(){const c=getComputedStyle(document.documentElement),t={};return t.fontFamily=c.getPropertyValue("font-family"),t.fontSize=parseFloat(c.getPropertyValue("font-size")),t.fontWeight=parseFloat(c.getPropertyValue("font-weight")),t.textHeight=Math.round(t.fontSize*1.3),t})();let x=class{constructor(t={}){}},L=class{constructor(t={}){}},b=class{constructor(t={}){}},N=class{constructor(t={}){this.x=0,this.y=0,this.scope={dpr:1,min:1,max:6,zoom:2,width:0,height:0},this.layers={},this.InitLayers(t.parentNode),window.addEventListener("resize",e=>{this.Resize()}),this.Resize(),this.diagrams=[],this.LoadDiagrams(),this.Loop()}Loop=()=>{this.isDataUpdate&&(this.DataUpdate(),this.isDataUpdate=!1),this.isLogUpdate&&(this.LogUpdate(),this.isLogUpdate=!1),(this.isDragging||this.isResizing)&&(this.Draw(),this.isDragging=!1,this.isResizing=!1),requestAnimationFrame(this.Loop)};get zoom(){return this.scope.zoom}set zoom(t){t>=this.scope.min&&t<=this.scope.max&&(this.scope.zoom=t)}LoadDiagrams(){this.diagrams=[];const t=new y.point({x:100,y:100,ctxDraw:this.layers.background.ctx});this.diagrams.push(t),this.diagrams.push(new y.point({x:0,y:0,color:"red",ctxDraw:this.layers.background.ctx}))}InitLayers(t){this.layers={},["background","board","effect"].forEach(e=>{this.layers[e]={},this.layers[e].cav=new A.element({type:"canvas",parentNode:t,class:`window ${e}`}),this.layers[e].cav.style.position="absolute",this.layers[e].cav.style.width="100%",this.layers[e].cav.style.height="100%",this.layers[e].ctx=this.layers[e].cav.getContext("2d")})}Resize(){this.scope.width=window.innerWidth,this.scope.height=window.innerHeight,Object.values(this.layers).forEach(t=>{p.SetCanvasDPR(t.cav,t.ctx,window.innerWidth,window.innerHeight),t.ctx.translate(window.innerWidth/2,window.innerHeight/2)}),this.isResizing=!0}SpaceX(t){return this.x+Math.round((t-this.scope.width/2)*this.zoom)}SpaceY(t){return this.y+Math.round((t-this.scope.height/2)*this.zoom)}SpaceLine(t){return Math.round(t*this.zoom)}PixelX(t){return Math.round((t-this.x)/this.zoom)}PixelY(t){return Math.round((t-this.y)/this.zoom)}PixelLine(t){return Math.round(t/this.zoom)}Draw(){Object.values(this.layers).forEach(t=>{const e=t.cav.width,s=t.cav.height;t.ctx.clearRect(-e/2,-s/2,e,s)}),this.DrawLine(100,200,200,100,"orange"),this.DrawLine(0,0,200,100,"orange"),this.DrawLine(0,0,100,200,"orange"),this.DrawRuler();for(let t of this.diagrams)t.Draw(this)}DrawRuler(){if(!this.layers.background)return;const t=this.layers.background.ctx,e=-this.scope.width/2+10,s=-this.scope.height/2+10,i=100,o=this.scope.height-20;t.fillStyle="rgba(44, 44, 54, 1)",t.fillRect(e,s,i,o)}DrawBackground(){if(!this.layers.background)return;const t=this.layers.background.ctx,e=this.layers.background.cav,s=100,i=this.x%s;t.save(),t.strokeStyle=rgba(44,44,64,1),t.beginPath(),this.SpaceX(e.height/2);const o=this.SpaceX(e.height);for(let n=i;n<=this.SpaceX(e.width);n+=s){const a=this.PixelLine(n);t.moveTo(a-o+2500,-o+2500),t.lineTo(a+o-2500,o-2500)}t.stroke(),t.restore()}DrawPoint(t,e,s){if(!this.layers.background)return;const i=this.layers.background.ctx,o=this.PixelX(t),n=this.PixelY(e);i.save(),i.font=`${h.fontWeight} ${h.fontSize}px ${h.fontFamily}`,i.fillStyle=s,i.textAlign="center",i.textBaseline="middle",i.fillText(`( ${t}, ${e} )`,o,n+h.textHeight),i.beginPath(),i.arc(o,n,4,Math.PI*2,!1),i.fill(),i.restore()}DrawLine(t,e,s,i,o){if(!this.layers.background)return;const n=this.layers.background.ctx,a=this.PixelX(t),g=this.PixelY(e),u=this.PixelX(s),I=this.PixelY(i);n.save(),n.strokeStyle=o,n.beginPath(),n.moveTo(a,g),n.lineTo(u,I),n.stroke(),n.restore()}};const Z=.001,D=.002;let S=class{constructor(t={}){const e=t.parentNode;e.addEventListener("contextmenu",async s=>{s.preventDefault()}),e.addEventListener("wheel",s=>{r.zoom-=s.deltaY*Z,r.isDragging=!0},{passive:!0}),e.addEventListener("mousedown",s=>{this.PanStart(s.offsetX,s.offsetY)}),e.addEventListener("mousemove",s=>{this.PanMove(s.offsetX,s.offsetY)}),e.addEventListener("mouseup",()=>{this.PanEnd()}),e.addEventListener("mouseleave",()=>{this.PanEnd()}),e.addEventListener("touchstart",s=>{if(s.touches.length===1&&this.touchMode!=="pinch"){const i=s.touches[0];this.touchMode="pan",this.PanStart(i.clientX,i.clientY)}if(s.touches.length===2){const i=s.touches[0],o=s.touches[1],n=i.clientX-o.clientX,a=i.clientY-o.clientY;this.touchMode="pinch",this.pinch={dist:Math.hypot(n,a)}}},{passive:!1}),e.addEventListener("touchmove",s=>{if(this.touchMode==="pan"&&s.touches.length===1){const i=s.touches[0];this.PanMove(i.clientX,i.clientY),s.preventDefault()}if(this.touchMode==="pinch"&&s.touches.length===2&&this.pinch){const i=s.touches[0],o=s.touches[1],n=i.clientX-o.clientX,a=i.clientY-o.clientY,g=Math.hypot(n,a),u=this.pinch.dist-g;this.pinch.dist=g,r.zoom+=u*D,r.isDragging=!0,s.preventDefault()}},{passive:!1}),e.addEventListener("touchend",s=>{if(this.touchMode==="pinch"&&s.touches.length<2){this.touchMode=null,this.pinch=null;return}this.touchMode==="pan"&&s.touches.length===0&&(this.touchMode=null,this.panEnd())})}PanStart(t,e){this.down={offsetX:t,offsetY:e,xView:r.x,yView:r.y},r.isDragging=!0}PanMove(t,e){if(!this.down)return;const s=r.SpaceLine(t-this.down.offsetX),i=r.SpaceLine(e-this.down.offsetY);r.x=this.down.xView-s,r.y=this.down.yView-i,r.isDragging=!0}PanEnd(){this.down=null}};class R{constructor(t={}){const s=window.location.port==="5500"?"/src/storage/db.worker.js":new URL("data:text/javascript;base64,DQppbXBvcnQgeyBfU0NIRU1BIH0gZnJvbSAnLi9zY2hlbWEuanMnDQpjb25zb2xlLmxvZygnd29ya2VyIGFsaXZlJykNCg0KLy8gZGIud29ya2VyLmpzDQpsZXQgZGIgPSBudWxsOw0KDQovLyDrqZTsi5zsp4AgSUTroZwg7JqU7LKtL+ydkeuLtSDrp6Tsua0NCnNlbGYub25tZXNzYWdlID0gYXN5bmMgKGUpID0+IHsNCiAgICBjb25zb2xlLmxvZygnd29ya2VyIG9ubWVzc2FnZTonLCBlLmRhdGEpOw0KICAgIHNlbGYucG9zdE1lc3NhZ2UoYGRiLndvcmtlciAtLT4gc3RvcmFnZTogJHtlLmRhdGF9YCk7DQp9DQogDQovLyAgIGNvbnN0IHsgaWQsIHR5cGUsIHBheWxvYWQgfSA9IGUuZGF0YTsNCiAgICANCi8vICAgdHJ5IHsNCi8vICAgICBpZiAodHlwZSA9PT0gJ2luaXQnKSB7DQovLyAgICAgICBpZiAoIWRiKSBkYiA9IGF3YWl0IG9wZW5EQigpOw0KLy8gICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7IGlkLCBvazogdHJ1ZSB9KTsNCi8vICAgICAgIHJldHVybjsNCi8vICAgICB9DQoNCi8vICAgICBpZiAoIWRiKSB0aHJvdyBuZXcgRXJyb3IoJ0RCIG5vdCBpbml0aWFsaXplZCcpOw0KDQovLyAgICAgaWYgKHR5cGUgPT09ICdnZXROb2RlJykgew0KLy8gICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbignbm9kZXMnLCAncmVhZG9ubHknKTsNCi8vICAgICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ25vZGVzJyk7DQovLyAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzdG9yZS5nZXQocGF5bG9hZC5pZCk7DQovLyAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsgaWQsIG9rOiB0cnVlLCByZXN1bHQgfSk7DQovLyAgICAgfQ0KDQovLyAgICAgaWYgKHR5cGUgPT09ICdwdXROb2RlJykgew0KLy8gICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbignbm9kZXMnLCAncmVhZHdyaXRlJyk7DQovLyAgICAgICB0eC5vYmplY3RTdG9yZSgnbm9kZXMnKS5wdXQocGF5bG9hZCk7DQovLyAgICAgICBhd2FpdCB0eC5kb25lOw0KLy8gICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7IGlkLCBvazogdHJ1ZSB9KTsNCi8vICAgICB9DQoNCi8vICAgfSBjYXRjaCAoZXJyKSB7DQovLyAgICAgc2VsZi5wb3N0TWVzc2FnZSh7IGlkLCBvazogZmFsc2UsIGVycm9yOiBlcnIubWVzc2FnZSB9KTsNCi8vICAgfQ0KLy8gfTsNCg0KLy8gLy8gREIg7Je06riwIO2VqOyImA0KLy8gYXN5bmMgZnVuY3Rpb24gb3BlbkRCKCkgew0KLy8gICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KLy8gICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIub3BlbignZGlhZ3JhbURCJywgMSk7DQoNCi8vICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IChldmVudCkgPT4gew0KLy8gICAgICAgY29uc3QgZGIgPSBldmVudC50YXJnZXQucmVzdWx0Ow0KLy8gICAgICAgaWYgKCFkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKCdub2RlcycpKSB7DQovLyAgICAgICAgIGRiLmNyZWF0ZU9iamVjdFN0b3JlKCdub2RlcycsIHsga2V5UGF0aDogJ2lkJyB9KTsNCi8vICAgICAgIH0NCi8vICAgICB9Ow0KDQovLyAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSAoZXZlbnQpID0+IHJlc29sdmUoZXZlbnQudGFyZ2V0LnJlc3VsdCk7DQovLyAgICAgcmVxdWVzdC5vbmVycm9yID0gKGV2ZW50KSA9PiByZWplY3QoZXZlbnQudGFyZ2V0LmVycm9yKTsNCi8vICAgfSk7DQovLyB9DQo=",import.meta.url);this.worker=new Worker(s,{type:"module"}),this.worker.onmessage=async i=>{console.log("storage onmessage",i.data)},this.worker.onerror=async i=>{console.log("storage err",i.message)},this.worker.postMessage("storage send to db.worker")}}const P=document.querySelector("#app");new R;l(b,"menu");l(L,"favorite");l(x,"directory");const r=l(N,"view");l(S,"controller");function l(c,t){const e=document.createElement("div");return e.id=t,P.appendChild(e),new c({parentNode:e})}
